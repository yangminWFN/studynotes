# 面试项目

## 一、华胜工程项目协同平台

### 项目职责：

#### 1、系统权限架构设计

**设计项目、人员、角色多对多关系表，按层级划分公司职位，对其中的项目层级人员进行分配相应的项目角色权限。**

#### 2、BIM模型上传与预览

**使用分块上传和断点续传的方式上传大文件BIM模型；将BIM模型在云端转化为网页可在线预览的SVF清单文件后，采用多线程的方式下载所有文件到公司服务器，提升网页加载速度。**

**实现细节：**

BIM模型全称是建筑信息模型，它能够使工程建设专业人员获取某个建筑的3D模型信息。这个功能主要就是实现BIM模型的上传和预览。由于BIM模型通常都是几百M的大文件，所以就使用了文件分块和断点续传的方式来进行文件上传。

1）首先在浏览器端使用`vue-simple-uploader`对大文件进行分块，指定分块大小，失败后重传次数等参数，然后使用`spark-md5`计算 `totalChuck mod 10`选取其中10块来求md5值（使用整个文件来求md5值太慢了）。

2）将文件的文件名和文件标识发送给服务器，服务器根据当前文件标识去数据库中查询是否已上传，如果上传过了，那么返回文件已上传标识和文件相对路径；如果没有上传过，那么将在数据库中查询已经上传了哪些块，返回已上传的所有块号。

3）前端根据返回信息，去除已上传的块号，将剩余的文件块上传到服务器，每个文件块包含==（文件名，文件标识--md5值，块号，块大小，总块数，块文件）==信息，服务端收到每一个块后写入到指定文件夹（文件夹的名称就是上传文件的标识），块文件文件名为（文件名-块号.tmp）。

4）当前端上传完所有块后，会发送一个合并请求，服务端首先会检查是否所有的分块都已经在指定目录中，然后依次将其他块追加到第一个块中，等待追加完后重命名该文件，写入文件信息到数据库中（如果文件标识不存在的话）。

5）数据库中有一个`file_info`和`chuck_info`表，分别为

```sql
--文件表
CREATE TABLE `t_file_info` (
  `id` varchar(64) NOT NULL,  --文件id
  `filename` varchar(500) NOT NULL,  --文件名
  `identifier` varchar(64) NOT NULL,  --文件标识（md5）
  `type` varchar(10) DEFAULT NULL,  --文件类型
  `total_size` decimal(10,0) NOT NULL,  --文件总大小
  `location` varchar(200) NOT NULL,  --文件存储路径
  `del_flag` varchar(2) NOT NULL DEFAULT '0',  --是否删除
  `ref_project_id` varchar(64) NOT NULL,  --项目id
  `upload_by` varchar(64) DEFAULT NULL,  --上传人
  `upload_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,  --上传时间
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--文件分块表
CREATE TABLE `t_chunk_info` (
  `id` varchar(64) NOT NULL,  --分块id
  `chunk_number` decimal(10,0) NOT NULL,  --块号
  `chunk_size` decimal(10,0) NOT NULL,    --块大小
  `current_chunkSize` decimal(10,0) NOT NULL,  -- 当前块大小
  `identifier` varchar(64) NOT NULL,   --文件标识（md5）
  `filename` varchar(500) DEFAULT NULL,  --文件名
  `relative_path` varchar(500) NOT NULL,  --相对路径
  `total_chunks` decimal(10,0) NOT NULL,  --总块数
  `type` decimal(10,0) DEFAULT NULL  --文件类型
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

==文件表`file_info`主要字段为：文件id，文件名，文件标识，文件存储路径==

==分块表`chunk_info`主要字段为：块id，块号，块大小，当前块大小，文件标识，文件名，存储路径，总块数==

#### 3、Word文件在线预览和编辑

**根据外部URL协议来编写脚本，打开用户本地的IE浏览器，内嵌本地Word到浏览器中，对文件进行在线编辑后上传到服务器；使用乐观锁机制来实现对文件的并发控制。**

**实现细节：**

华胜公司需要做一个Word文件在线编制的功能，我们首先是找了一个可以内嵌用户本地的Word到浏览器的在线预览插件，但这个插件只可以在IE中使用，考虑到用户可能会使用其他的浏览器打开，所以必须实现这样的一个功能：==如果用户当前使用的是IE内核的浏览器，那么就在当前浏览器中新开一个窗口；如果不是IE浏览器，那么就使用外部URL协议打开用户本地的IE浏览器。==当时想到使用外部URL协议，主要是由于在某次使用百度云时，在网页山保存了资源，想要下载时就会弹出一个提示要不要打开本地的百度云客户端，所以按这种方式去搜索，就找到了使用外部URL协议。

然后在IE浏览器中调用一个链接在线预览服务器上的Word文件，相当于是把用户本地的Word嵌入到了浏览器内，用户就可以在浏览器中对文件进行修改，然后点击上传按钮，保存到服务器中。但是这样会有一个并发修改的问题，可能会有两个人同时读取到服务器上的Word文件到本地浏览器，一个人修改后上传，另一个也修改后上传，后面上传的就会覆盖前一个人上传的。所以为了解决这个问题，我在文件表中添加了一个最后更新时间字段，每次在读取文件到本地浏览器时，会将文件的最后更新时间和文件都返回给浏览器端。在用户上传时，会将这个时间和修改后的文件上传到服务器，后端通过判断这个时间是否是数据库中的最后更新时间，如果是，那么更新数据库记录，覆盖对应文件。如果不是，那么说明这个文件已经被其他人修改了，所以需要先获取最新版，修改后再次上传。所以此时，就会提示用户保存刚刚修改的文件到本地，然后打开一个新的链接，这个链接就会返回修改后的文件和更新之后的时间。用户确认修改无误后，就再次提交。有点类似乐观锁中的CAS操作。

**外部URL协议：**

桌面应用程序其实也早就支持关联 URL 以便在浏览器中打开。当我们的程序关联了一个 URL 协议之后，开发的网站上就可以通过这个 URL 与程序进行互操作。

1、注册一个 URL 协议

要在 Windows 系统上注册一个 URL 协议，你只需要两个步骤：

- 好好想一个协议名称
- 在注册表中添加协议关联

2、例如`http://www.baidu.com`是一个协议，在注册表中添加一个自己的`prereadword://www.baidu.com`，这个prereadword就是自己定义的协议。

### 项目技术栈：

**Spring，SpringMVC，SpringBoot，Spring Security，Mybatis，MySQL，Thymeleaf，JQuery，Bootstrap**

### 项目成果：

**软件著作权三项。             项目地址：http://119.97.224.22:89/HSEPS （已上线）**

## 二、空气质量大数据分类算法优化项目

### 项目介绍：

**针对传统串行自适应差分进化极限学习机算法（SaDE-ELM）在湖北省空气质量监测数据集上运行效率不高的问题，使用Spark框架对算法进行并行化，在保证预测精度不丢失的情况下，显著地提升了算法的运行效率。**

### 项目职责：

1. **搭建 Hadoop、Spark集群，使用Eclipse连接集群将SQL Server数据库中空气质量监测大数据导入到 HDFS。**
2. **使用 Spark 对 HDFS 中的数据进行预处理操作，包括OneHot编码、数据归一化和PCA降维等。**
3. **实现并行的 SaDE-ELM 算法，将原有进化种群分割为多个子种群，每个子种群共同进化得到最优个体，使用最优个体来对数据集进行分类，算法运行效率提升了260%。**

### 项目成果：

**科研论文两篇 （EI检索一篇，RCCSE核心一篇）**

## 三、武汉建设监理咨询行业信用评价平台

### 项目介绍：

**将每两年一度的武汉监理与咨询协会对各个申报企业的信用评价流程线上化，主要流程为评分细则管理、企业申报、专家评分、评分结果展示与导出和企业评级。**

### 项目职责：

1. **评审版本管理功能。将评分细则、申报企业、评分结果等与年度信息关联，每开启新一年度的评审活动时使用反序列化的方式来对繁杂的企业申报信息进行深拷贝。**
2. **评分任务分配。管理员为专家组分配人员，为每个专家组分配待评审企业，最后由专家组组长对专家进行评分细则项的分配。**
3. **动态评分细则表导出功能。根据评分细则表的树结构导出带有合并信息的评分细则Excel表格。**

### 项目成果：

**软件著作权两项         项目地址：http://119.97.224.22:88（已上线）**